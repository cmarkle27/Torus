<!DOCTYPE html> 
<html> 
<head>
<title>Untitled</title>
<style type="text/css">
	body { background: #6b6b6b; margin:0; padding:0; }
	canvas { background-image: url("img/space_bg.jpg"); border: solid 10px #000; float: left; }
	#wrapper { margin: 20px; }
</style>
</head>

<body>
<div id="wrapper" class="clearfix">
	<canvas id="torusScreen" width="480" height="600"></canvas>
</div>

<script type="text/javascript">

var canvas = document.getElementById("torusScreen");
var context = canvas.getContext("2d");

var tileSize = 40;
var tileImage = new Image();

tileImage.src = 'img/tile4.png';

var gameLoop = function(toroid) {

	Toroid.clear(toroid);
	
	// make into method
	toroid.altitude += 1;
	
	Toroid.draw(toroid);
	
	setTimeout(function() { gameLoop(toroid); }, 1000);

}

var Toroid = (function() {

	var nextId = 1;
	
	// shapes
	var j = new Array();
	var i, o, l, s, z, t;
	
	j[0] = {
		"name" : "jNorth",
		"x" : [2, 1, 1, 1,],
		"y" : [1, 1, 2, 3]
	};

	j[1] = {
		"name" : "jSouth",
		"x" : [2, 1, 1, 3,],
		"y" : [1, 1, 2, 1]
	};
	
	
	function randomShape() {
		return j;//[Math.floor(Math.random() * 2)];
	};
	
	function randomColor() {
		var colors = ["#cc0000", "#3399ff", "#ffff33", "#33cc00", "#666666", "#3333ff", "#339900", "#bbbbbb"];
		return colors[Math.floor(Math.random() * colors.length)];
	};	
	

		
	// constructor
	var cls = function() {
	
		// private
		var id = nextId++;
		
		// make getters?
		this.color = randomColor();
		this.shape = randomShape();
		this.orientation = 1;
		this.altitude = 1;
		
		// public (this instance only)
		this.getId = function() {
			return id;
		};

		
		// we will need a method to return blocks???
		
		this.set_name = function(value) {
			if (typeof value != 'string') throw 'Name must be a string';
			if (value.length < 2 || value.length > 20) throw 'Name must be 2-20 characters long.';
			name = value;
		};
		
	};
	
	
	// move to board?
	cls.draw = function(toroid) {
	
		var x = toroid.shape[toroid.orientation]["x"];
		var y = toroid.shape[toroid.orientation]["y"];
		var color = toroid.color;
		var altitude = toroid.altitude;
		var xCoord, yCoord;
			
		for (var i = 0; i < 4; i++) {
			
			xCoord = (x[i]*tileSize);
			yCoord = (y[i]*tileSize) + (altitude*tileSize);
									
	     	context.beginPath();
	        context.rect(xCoord, yCoord, tileSize, tileSize);
	        context.fillStyle = color;
	        context.fill();
			
		    context.drawImage(tileImage, xCoord, yCoord, tileSize, tileSize);			
			
		}
	};
	
	cls.clear = function(toroid) {

		var x = toroid.shape[toroid.orientation]["x"];
		var y = toroid.shape[toroid.orientation]["y"];
		var altitude = toroid.altitude;
		var xCoord, yCoord;
			
		for (var i = 0; i < 4; i++) {
			
			xCoord = (x[i]*tileSize);
			yCoord = (y[i]*tileSize) + (altitude*tileSize);
						
		    context.clearRect(xCoord, yCoord, tileSize, tileSize);		
			
		}
	};



	
	//remove & drop blocks for torus
	//...

	// public static
	cls.get_nextId = function() {
		return nextId;
	};
	
	// public (shared across instances)
	cls.prototype = {
		announce: function() {
			alert('Hi there! My id is ' + this.get_id() + ' and my name is "' + this.get_name() + '"!\r\n' + 'The next fellow\'s id will be ' + MyClass.get_nextId() + '!');
		}
	};
	
	return cls;
	
})();
</script>
</body>
</html>
