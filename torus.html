<!DOCTYPE html> 
<html> 
<head>
<title>Untitled</title>
<style type="text/css">
	body { background: #222222; margin:0; padding:0; }
	canvas { background-image: url("img/space_bg.jpg"); border: solid 10px #000; float: left; }
	#wrapper { margin: 20px; }
	.clearfix { overflow: hidden; zoom: 1; }
</style>
</head>

<body>
<div id="wrapper" class="clearfix">
	<canvas id="torusScreen" width="480" height="600"></canvas>
</div>

<script type="text/javascript">

var canvas = document.getElementById("torusScreen");
var context = canvas.getContext("2d");

var tileSize = 40;
var tileImage = new Image();

tileImage.src = 'img/tile4.png';


var transformation = {
	altitude: 0,
	rotation: 0,
	orientation: 0
};

var rotate = function(toroid) {
	
	var orientation = toroid.orientation + 1;
	var shapeLength = toroid.shape.length;
	
	if (orientation > shapeLength) {
		orientation = 0;
	}
	
	transformation.orientation = orientation;
	
};


var gameLoop = function() {

	toroid = new Toroid();
	
	Toroid.clear(toroid);
	
	// fall
	// make into method
	transformation.altitude += 1;



	//Toroid.clear(toroid); ???
	
	
	// apply transformations
	// we need to add to a diffrent var which will be later added to altitude???
	newToroid = Toroid.transform(toroid, transformation);
	
	// alt
	// rot
	// pos
	// spd
	
	
	Toroid.draw(newToroid);
	
	setTimeout(function() { gameLoop(); }, 1000);

}


var Toroid = (function() {

	var nextId = 1;
	
	var shapes = ["j", "l", "o", "i", "s", "z", "t"];
	
	shapes["j"] = [];
	
	shapes["j"][0] = {
		"x" : [0, 1, 1, 1],
		"y" : [2, 2, 1, 0]
	};

	shapes["j"][1] = {
		"x" : [0, 0, 1, 2],
		"y" : [0, 1, 1, 1]
	};

	shapes["j"][2] = {
		"x" : [0, 0, 0, 1],
		"y" : [0, 1, 2, 0]
	};
		
	shapes["j"][3] = {
		"x" : [0, 1, 2, 2],
		"y" : [0, 0, 0, 1]
	};
	
		
	function randomShape() {
		return shapes["j"];//[Math.floor(Math.random() * shapes.length)];
	};
	
	function randomColor() {
		var colors = ["#cc0000", "#3399ff", "#ffff33", "#33cc00", "#666666", "#3333ff", "#339900", "#bbbbbb"];
		return colors[Math.floor(Math.random() * colors.length)];
	};	
	

		
	// constructor
	var cls = function() {
	
		// private
		var id = nextId++;
		
		// make getters?
		this.color = randomColor();
		this.shape = randomShape();
		this.orientation = 1;
		this.altitude = 1;
		
		// public (this instance only)
		this.getId = function() {
			return id;
		};

		
		// we will need a method to return blocks???
		
		this.set_name = function(value) {
			if (typeof value != 'string') throw 'Name must be a string';
			if (value.length < 2 || value.length > 20) throw 'Name must be 2-20 characters long.';
			name = value;
		};
		
	};
	
	//transform
	
	
	// move to board?
	cls.draw = function(toroid) {
	
		var x = toroid.shape[toroid.orientation]["x"];
		var y = toroid.shape[toroid.orientation]["y"];
		var color = toroid.color;
		var altitude = toroid.altitude;
		var xCoord, yCoord;
			
		for (var i = 0; i < 4; i++) {
			
			xCoord = (x[i]*tileSize);
			yCoord = (y[i]*tileSize) + (altitude*tileSize);
									
	     	context.beginPath();
	        context.rect(xCoord, yCoord, tileSize, tileSize);
	        context.fillStyle = color;
	        context.fill();
			
		    context.drawImage(tileImage, xCoord, yCoord, tileSize, tileSize);			
			
		}
	};
	
	cls.clear = function(toroid) {

		var x = toroid.shape[toroid.orientation]["x"];
		var y = toroid.shape[toroid.orientation]["y"];
		var altitude = toroid.altitude;
		var xCoord, yCoord;
			
		for (var i = 0; i < 4; i++) {
			
			xCoord = (x[i]*tileSize);
			yCoord = (y[i]*tileSize) + (altitude*tileSize);
						
		    context.clearRect(xCoord, yCoord, tileSize, tileSize);		
			
		}
	};


	cls.transform = function(toroid, transformation) {
		toroid.altitude = transformation.altitude;
		toroid.orientation = transformation.orientation;
		toroid.rotation = transformation.rotation;
		
		//hmmm
		return toroid;
		
	}

	
	//remove & drop blocks for torus
	//...

	// public static
	cls.get_nextId = function() {
		return nextId;
	};
	
	// public (shared across instances)
	cls.prototype = {
		announce: function() {
			alert('Hi there! My id is ' + this.get_id() + ' and my name is "' + this.get_name() + '"!\r\n' + 'The next fellow\'s id will be ' + MyClass.get_nextId() + '!');
		}
	};
	
	return cls;
	
})();
</script>
</body>
</html>
